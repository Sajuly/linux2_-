## Part 1. Инструмент ipcalc<br>

### 1.1 Сети и маски
* Адрес сети 192.167.38.54/13
`sudo apt install ipcalc`
`ipcalc 192.167.38.54/13`
![версия ubuntu](scr1.png)<br>
* Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную.<br>
https://infocisco.ru/prefix_network_mask.html<br>
![версия ubuntu](scr2.png)<br>
* Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4.<br>
![версия ubuntu](scr3.png)<br>
![версия ubuntu](scr4.png)<br>
![версия ubuntu](scr5.png)<br>
![версия ubuntu](scr6.png)<br>
### 1.2 localhost
* Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1<br>
![версия ubuntu](scr7.PNG)<br>
к localhost адресам относятся 127.0.0.0/8 (127 неизменно остальное может меняться). Поэтому оможно обратиться к приложениям с IP  127.0.0.2 и 127.1.0.1<br> 
### Диапазоны и сегменты сетей
* 1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1<br>
![версия ubuntu](scr7.PNG)<br>
по аналогии к приватным/частным относятся: 10.0.0.45  192.168.4.2  172.20.250.4  172.16.255.255  10.10.10.10<br>
остальные к публичным: 143.43.0.2  172.0.2.1  192.172.0.1  172.68.0.2  192.169.168.1<br>
* 2) какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255<br>
![версия ubuntu](scr9.PNG)<br>
обращая внимание на диапазоны hostmin/hostmax: 10.10.0.2  10.10.10.10  10.10.1.255<br>

## Part 2. Статическая маршрутизация между двумя машинами<br>

### Поднять две виртуальные машины (далее -- ws1 и ws2)
* С помощью команды ip a посмотреть существующие сетевые интерфейсы
![версия ubuntu](scr10.PNG)<br>
Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12<br>
* В отчёт поместить скрины с содержанием изменённого файла etc/netplan/00-installer-config.yaml для каждой машины.
Выключаем машины - настройки(для каждой) - сеть - адаптер 2 - вкл - тип подключения: внутреняя сеть - имена должны быть одинковы для обеих машин.<br>
`sudo vim /etc/netplan/00-installer-config.yaml`<br>
![версия ubuntu](scr11.PNG)<br>
`sudo netplan apply` && `ip a` `reboot` <br>
![версия ubuntu](scr12.PNG)<br>

### Добавление статического маршрута вручную
Добавление статического маршрута от одной машины до другой и обратно при помощи команды ip r add. <br>
ws1 - `sudo ip r add 172.24.116.8 dev enp0s8`  ws2 - `sudo ip r add 192.168.100.10 dev enp0s8` <br>
![версия ubuntu](scr13.PNG)<br>
### Добавление статического маршрута с сохранением
`sudo vim /etc/netplan/00-installer-config.yaml`<br>
`sudo netplan apply` `reboot`
![версия ubuntu](scr14.PNG)<br>
![версия ubuntu](scr13.PNG)<br>

## Part 3. Утилита iperf3
* Скорость соединения<br>
Перевести и записать в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps.<br>
8 Mbps = 1 MB/s. (1 Mbps = 0.125 MB/s)<br>
100 MB/s = 100 000 Kbps. (1 MB/s = 1000 Kbps)<br>
1 Gbps = 1000 Mbps.<br>
* Утилита iperf3<br>
Измерить скорость соединения между ws1 и ws2<br>
`sudo apt install iperf3` <br>
ws1`iperf3 -s`<br>
ws2`iperf3 -c 192.168.100.10 -p 5201`<br>
![версия ubuntu](scr3.1.PNG)<br>
## Part 4. Сетевой экран
### Утилита iptables
`sudo apt-get install iptables`<br>
Создать файл /etc/firewall.sh, имитирующий фаерволл, на ws1 и ws2:
`sudo vim /etc/firewall.sh
1) на ws1 применить стратегию когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило (это касается пунктов 4 и 5)<br>
2) на ws2 применить стратегию когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило (это касается пунктов 4 и 5)<br>
3) открыть на машинах доступ для порта 22 (ssh) и порта 80 (http)<br>
4) запретить echo reply (машина не должна "пинговаться”, т.е. должна быть блокировка на OUTPUT)<br>
5) разрешить echo reply (машина должна "пинговаться")<br>
![версия ubuntu](scr4.1.PNG)<br>
### Запустить файлы на обеих машинах командами `sudo chmod +x /etc/firewall.sh` и `sudo sh /etc/firewall.sh` <br>
ws1 - INPUT для пакетов на ping-reply DROP - не работает т.е. пакеты отправляет, но не принемает.<br>
ws2 - INPUT для пакетов на ping-reply ACCEPT - работает.<br>
![версия ubuntu](scr4.2.PNG)<br>
## Утилита nmap
Устанавливаем nmap `sudo apt-get install nmap`<br>
Командой ping найти машину, которая не "пингуется", после чего утилитой nmap показать, что хост машины запущен.<br>
![версия ubuntu](scr4.3.PNG)<br>
## Part 5. Статическая маршрутизация сети
### 5.1. Настройка адресов машин
Настроить конфигурации машин в etc/netplan/00-installer-config.yaml согласно сети на рисунке.<br>
![версия ubuntu](scr5.1.PNG)<br>
`sudo vim /etc/netplan/00-installer-config.yaml`<br>
![версия ubuntu](scr5.1.1.PNG)<br>
`sudo netplan apply`<br>
Перезапустить сервис сети. Если ошибок нет, то командой ip -4 a проверить, что адрес машины задан верно. Также пропинговать ws22 && ws21. Аналогично пропинговать r1 && ws11.<br>
![версия ubuntu](scr5.1.ws11.PNG)<br>
![версия ubuntu](scr5.1.r1.PNG)<br>
![версия ubuntu](scr5.1.ws21.PNG)<br>
![версия ubuntu](scr5.1.ws22.PNG)<br>
### 5.2. Включение переадресации IP-адресов. 
* Для включения переадресации IP, выполните команду на роутерах: `sudo sysctl -w net.ipv4.ip_forward=1`
При таком подходе переадресация не будет работать после перезагрузки системы.<br>
![версия ubuntu](scr5.2r1r2.PNG)<br>
* Откройте файл /etc/sysctl.conf и добавьте в него следующую строку: net.ipv4.ip_forward = 1. (убрать решетку)
При использовании этого подхода, IP-переадресация включена на постоянной основе.<br>
![версия ubuntu](scr5.2.2r1r2.PNG)<br>
### 5.3. Установка маршрута по-умолчанию
Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить gateway4 [ip роутера] в файле конфигураций<br>
`sudo vim /etc/netplan/00-installer-config.yaml`
ws11<br>
![версия ubuntu](scr5.3.PNG)<br>
`sudo netplan apply`
* Вызвать ip r и показать, что добавился маршрут в таблицу маршрутизации<br>
![версия ubuntu](scr5.3.1.PNG)<br>
Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит. Для этого использовать команду: tcpdump -tn -i eth1<br>
`sudo tcpdump -tn -i enp0s8` <br>
![версия ubuntu](scr5.3.2.PNG)<br>
### 5.4. Добавление статических маршрутов
* Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций. Пример для r1 маршрута в сетку 10.20.0.0/26:
![версия ubuntu](scr5.4.1.PNG)<br>
* Вызвать ip r и показать таблицы с маршрутами на обоих роутерах.
![версия ubuntu](scr5.4.2.PNG)<br>
* Запустить команды на ws11: ip r list 10.10.0.0/18 && ip r list 0.0.0.0/0
![версия ubuntu](scr5.4.3.PNG)<br>
В отчете выбран путь отличный от 10.10.0.0 - этот адрес указывает на все адреса.<br>
### 5.5 Построение списка маршрутизаторов
Запустить на r1 команду дампа: tcpdump -tnv -i enp0s8 (с другой машины попинговать на роутер)
![версия ubuntu](scr5.5.1.PNG)<br>
При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21 <br>
`sudo apt install traceroute` `sudo apt install inetutils-traceroute`
(потерялась связь с интернетом `sudo ip link set enp0s8 down`. После установки пакетов вернуь как было `sudo ip link set enp0s8 up`).
![версия ubuntu](scr5.5.2.PNG)<br>
Путь строится от узла к узлу до того момента, пока не будет достигнута конечная точка. Каждый пакет проходит на своем пути определенное количество узлов, пока не достигнет своей цели. На каждом узле добавляется счетчик, который отслеживает количество пройденых узлов.<br>
### 5.6 Использование протокола ICMP при маршрутизации
* Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды: `tcpdump -n -i enp0s8 icmp` (попинговать с другой машины)
![версия ubuntu](scr5.6.1.PNG)<br>
* Пропинговать с ws11 несуществующий IP (например, 10.30.0.111) с помощью команды: ping -c 1 10.30.0.111
![версия ubuntu](scr5.6.2.PNG)<br>
## Part 6. Динамическая настройка IP с помощью DHCP
* Для r2 настроить в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP
![версия ubuntu](scr6.1.PNG)<br>
* в файле /etc/resolv.conf прописать nameserver 8.8.8.8.
![версия ubuntu](scr6.2.PNG)<br>
* Перезагрузить службу DHCP командой systemctl restart isc-dhcp-server
![версия ubuntu](scr6.3.PNG)<br>
Машину ws21 перезагрузить при помощи `reboot` и через `ip a` показать, что она получила адрес.
![версия ubuntu](scr6.4.PNG)<br>
Также пропинговать ws22 && ws21.
![версия ubuntu](scr6.5.PNG)<br>
Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true
![версия ubuntu](scr6.6.PNG)<br>
Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты.
![версия ubuntu](scr6.7.PNG)<br>
в файле r1 /etc/resolv.conf прописать nameserver 8.8.8.8.
![версия ubuntu](scr6.8.PNG)<br>
Перезагрузить r1 службу DHCP командой systemctl restart isc-dhcp-server<br>
Машину ws11 перезагрузить при помощи sudo reboot и через ip a показать, что она получила адрес.<br>
![версия ubuntu](scr6.9.PNG)<br>
* Запросить с ws21 обновление ip адреса
![версия ubuntu](scr6.10.PNG)<br>
